# 今回のテーマ

- C言語における標準入出力について学ぶ

# 標準入出力とは

- 標準入力とは、キーボードからの入力を受け付けること
- 標準出力とは、コンソールに出力すること

# 標準出力

## printf関数

標準出力は、`printf`関数を用いて行う
`printf`関数は、第一引数に出力の形式を指定し、第二引数以降に出力する変数を指定する
printf関数の第一引数は書式指定文字列という特殊な文字列を入れる。

```c
printf("第二引数は%d", 123);
```

結果：
```
第二引数は123
```

このコードでは、`%d`という書式指定文字列を用いて、第二引数の`123`を出力している。

書式指定文字列を複数使用した場合は第三引数以降の値が表示される。

```c
printf("%d, %d", 123, 456);
```

```
123, 456
```

:::note warn
文字列変数をprintf関数で表示する場合、セキュリティ上の理由から、第一引数に文字列変数を指定するのではなく書式指定文字列を使用して表示することが推奨されている。
特に外部から入力された文字列を表示する場合、それを悪用した攻撃の手段になり得る。

```c
char str[100];

// 非推奨
printf(str);

// 推奨
printf("%s", str);
```
:::

## printf_s関数

`printf_s`関数は`printf`関数のセキュリティを強化したものである。
`printf`関数は書式指定文字列に`NULL`が渡された場合にエラーとなるが、`printf_s`関数は書式指定文字列に不正な形式の文字列が渡された場合にもエラーとなる。

```c
//エラーにはならない
printf("%q", 123);

//エラー
printf_s("%q", 123);
```

## フラグ

フラグは出力位置や書式指定文字列の意味を設定するもの。
フラグは複数指定でき、順序は任意かつ省略可能。

<table>
<thead>
  <tr>
    <th>フラグ</th>
    <th>説明</th>
    <th>既定値</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>-</td>
    <td>左寄せ</td>
    <td>右寄せ</td>
  </tr>
  <tr>
    <td>+</td>
    <td>符号を常に表示</td>
    <td>符号を負の場合のみ表示</td>
  </tr>
  <tr>
    <td>0</td>
    <td>空白を0で埋める</td>
    <td>空白で埋める</td>
  </tr>
  <tr>
    <td>空白</td>
    <td>正の数の場合は空白を表示</td>
    <td>何もしない</td>
  </tr>
  <tr>
    <td rowspan="5">#</td>
    <td>o変換(8進数表記)の場合、先頭に0が追加される<br>値が0の場合は何もしない</td>
    <td>何もしない</td>
  </tr>
  <tr>
    <td>x、X変換(16進数表記)の場合、先頭に0x、0Xが追加される<br>値が0の場合は何もしない</td>
    <td>何もしない</td>
  </tr>
  <tr>
    <td>e、E、f、F、a、A変換(小数値)の場合、小数点以下の数値を表示しない場合でも小数点を表示する</td>
    <td>何もしない</td>
  </tr>
  <tr>
    <td>g、G変換(double型)の場合、小数点以下の数値を表示しない場合でも小数点を表示し、続く0を表示する</td>
    <td>何もしない</td>
  </tr>
  <tr>
    <td>上記以外の変換に#フラグを付けた場合は未定義</td>
    <td></td>
  </tr>
</tbody>
</table>

## 最小フィールド幅

最小フィールド幅は、表示される文字列の最小の文字数を指定する。
指定よりも実際に表示する文字数の方が大きい場合は自動で拡張される。
最小フィールド幅は省略可能。
最小フィールド幅は正の整数値またはアスタリスク(*)で指定する。
アスタリスクを指定した場合は第二引数の数値の幅が設定される。
  
```c
printf("%5d", 123);
```

```
00123
```

```c
printf("%*d", 5, 123);
```

```
00123
```

上記のコードでは、最小フィールド幅を5としている。
また、見やすくするために0で埋めているが実際には空白で埋められる。

アスタリスクを使用した場合に負数を最小フィールド幅を指定した場合、-フラグが指定されたものと解釈されます。

```c
printf("%*d", -5, 123);
```

```
123
```

### 引数の順序

書式指定文字列内にアスタリスクを指定する変換指定が複数存在する場合、引数は「最小フィールド幅, 変換される値, 最小フィールド幅, 変換される値...」の順となる。
  
```c
printf("%0*d, %0*d", 5, 123, 5, 456);
```

```
00123, 00456
```

## 精度指定

精度指定は表示する文字列の文字数を指定する。
精度指定は省略可能。

精度指定はピリオド(.)に続く正の整数値またはアスタリスク(*)で指定する。

アスタリスクを指定した場合は第二引数の数値の幅が設定される。
引数の順序に関しては最小フィールド幅と同じ。(引数の順序参照)
アスタリスクを使用する場合に、負数を精度指定にした場合は無視される。

| 変換指定子        | 説明                                            | 既定値          |
|:-------------|:----------------------------------------------|:-------------|
| d、i、o、u、x、X　 | 最小桁数の指定<br>指定の値が実際の文字数よりも小さい場合は0で埋める          | 1            |
| e, E, f, F   | 小数部(小数点の後ろの数値)の有効桁数の指定<br>桁の最後は丸められる(0で埋められる) | 6            |
| g, G         | 有効桁数の指定                                       | 6            |
| s            | 有効文字列数                                        | 表示される文字列の文字数 |

上記以外の変換指定子に精度指定をした場合の動作は未定義。

# 標準入力

標準入力は、`scanf`関数を用いて行う
`scanf`関数は、第一引数に入力の形式を指定し、第二引数に入力を格納する変数のアドレスを指定する

```c
#include <stdio.h>

int main(void) {
    int a;
    scanf("%d", &a);
    printf("%d\n", a);
    return 0;
}
```

```
123
123
```

## scanf_s 関数

`scanf_s`関数は、`scanf`関数のセキュリティ強化版である。
scanf_s関数はいくつかの書式指定文字列を指定した場合に、入力対象の引数の次の引数に入力されるデータのサイズを指定する必要がある。
読み取られるデータサイズが制限されるためセキュリティが向上する。

```c
char str[8];
scanf_s("%7s", str, 8);

printf("今入力した値:%s", str);
```

```
123456789
今入力した値:1234567
```

## 書式指定文字列

書式指定文字列は変換指定子をひとつ以上含む文字列。
変換指定子は%記号から始まる。
書式指定は以下の説明に登場する順序で指定する。
変換指定子以外の書式指定は省略可能。

### 代入抑止文字

代入抑止文字は指定された通りの読み取りは行われるが、引数への格納は行われない。 つまり入力は読み捨てられます。
代入抑止文字は*(アスタリスク)。 省略可能。

```c
int num = 0;
scanf("%*d", &num);
//numには何も入力されない
```

### 最大フィールド幅

最大フィールド幅は変数に格納される最大の文字数を指定する。
最大フィールド幅以上の入力があった場合、読み取れなかった分は標準入力にデータが残る。
最大フィールド幅は1以上の整数で指定。 省略可能。

```c
char str[16];
scanf("%15s", &str);
//strには15文字以上入力されない
```

### 長さ修飾子

長さ修飾子は実引数のデータ型(サイズ)を指定する。 省略可能。

| 修飾子 | 変換指定子           | 説明                                 |
|:----|:----------------|:-----------------------------------|
| hh  | d、i、o、u、x、X     | char型またはunsigned char型             |
| h   | d、i、o、u、x、X     | short型またはunsigned short型の値         |
|     | s, S            | 1バイトの文字列                           |
| l   | d、i、o、u、x、X     | long型またはunsigned long型の値           |
|     | e, E, f, F、g, G | double型の値                          |
|     | s, S            | wchar_t型の文字列 (ワイド文字列型)             |
| ll  | d、i、o、u、x、X     | long long型またはunsigned long long型の値 |
| L   | e, E, f, F、g, G | long double型の値                     |

### 変換指定子

変換指定子は、入力されたデータをどのように変換するかを指定する。

| 変換指定子            | 引数の型         | 説明                                                                                                                                                                    | scanf_s関数でのサイズ指定                      |
|:-----------------|:-------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------|
| d                | 整数へのポインタ     | 10進数の整数                                                                                                                                                               | 指定しない                                 |
| i                | 整数へのポインタ     | 	整数<br>0xから始まる場合は16進数<br>0から始まる場合は8進数<br>それ以外は10進数                                                                                                                    | 指定しない                                 |
| o                | 符号なし整数へのポインタ | 8進数の整数                                                                                                                                                                | 指定しない                                 |
| u                | 符号なし整数へのポインタ | 10進数の整数                                                                                                                                                               | 指定しない                                 |
| x, X             | 符号なし整数へのポインタ | 16進数の整数                                                                                                                                                               | 指定しない                                 |
| e, E, f, F, g, G | 小数へのポインタ     | 浮動小数点数<br>指数部はeまたはE、fまたはF、gまたはGで指定する                                                                                                                                  | 指定しない                                 |
| c                | char型へのポインタ  | 	文字<br>空白文字を区切り文字としない<br>(空白も読み取る)<br>最大フィールド幅に2以上を指定することで配列への格納も可能<br>その際に終端にNULL文字は付加しない                                                                            | 保存先領域のサイズ(文字数)を指定<br>最大フィールド幅と同時に指定する |
| s                | char型へのポインタ  | 	文字列<br>終端にNULL文字を付加する<br>最大フィールド幅は保存先領域サイズより1少ない値を指定する                                                                                                               | 保存先領域のサイズ(文字数)を指定<br>最大フィールド幅と同時に指定する |
| []               | char型へのポインタ  | 	 	文字種の指定<br>[]内に読み取る文字を指定する<br>[abc]を指定すればaまたはbまたはcが入力された場合に読み取る<br>[^a]を指定すればa以外が入力された場合に読み取る<br>[0-9]などの範囲指定が可能<br>終端にNULL文字を付加する<br>最大フィールド幅は保存先領域サイズより1少ない値を指定する | 保存先領域のサイズ(文字数)を指定<br>最大フィールド幅と同時に指定する |
| p                | void型        | 	ポインタ                                                                                                                                                                 | 指定しない                                 |
| n                | 整数へのポインタ     | 	 	入力の読み取りは行わない<br>現時点までに入力された文字数を整数へのポインタに格納する                                                                                                                       | 指定しない                                 |

## 戻り値

scanf関数の戻り値は入力された項目の数を返す。 エラーが発生した場合はEOFを返す。

# 規格ごとの差異

書式指定文字列の追加等の差異はあるものの、基本的には標準入出力の仕様は変わっていない。
大きな差異はないものの、変換指定子などの追加は時折あるので注意が必要。

# まとめ

標準入出力はC言語の基本的な機能であり、プログラムの入出力には必須の機能である。
Ｃ言語では標準入出力を行うための関数として、scanf関数、printf関数などが用意されている。
またそれらはstdio.hヘッダファイルに定義されている。
